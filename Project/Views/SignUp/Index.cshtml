@model Project.Models.SignUp
@using Microsoft.AspNetCore.Http
@{
    Layout = null;
    var isSignedUp = Context.Session.GetString("IsSignedUp");
    var fullName = Context.Session.GetString("FullName");
}
<!doctype html>
<html lang="en" class="layout-wide customizer-hide" dir="ltr" data-bs-theme="light">

<head>
    <meta charset="utf-8" />
    <title>Sign Up</title>

    <link rel="stylesheet" href="~/assets/vendor/css/core.css" />
    <link rel="stylesheet" href="~/assets/css/demo.css" />
    <link rel="stylesheet" href="~/assets/vendor/css/pages/page-auth.css" />

    <script src="~/assets/vendor/js/helpers.js"></script>
    <script src="~/assets/js/config.js"></script>
</head>

<body>

    <div class="authentication-wrapper authentication-cover">

        <div class="authentication-inner row m-0">

            <div class="d-flex col-12 col-lg-5 col-xl-4 align-items-center authentication-bg position-relative py-5 px-5">

                <div class="w-px-400 mx-auto">

                    <h4 class="mb-1">Create Account 🚀</h4>

                    @if (TempData["Success"] != null)
                    {
                        <div class="alert alert-success">@TempData["Success"]</div>
                    }

                    <form asp-action="Index" asp-controller="SignUp" method="post">

                        <div class="form-floating mb-3">
                            <input asp-for="FullName" class="form-control" />
                            <label asp-for="FullName"></label>
                            <span asp-validation-for="FullName" class="text-danger"></span>
                        </div>

                        <div class="form-floating mb-3">
                            <input asp-for="Phone" class="form-control" />
                            <label asp-for="Phone"></label>
                            <span asp-validation-for="Phone" class="text-danger"></span>
                        </div>

                        <div class="form-floating mb-3">
                            <input asp-for="Email" class="form-control" id="Email" />
                            <label asp-for="Email"></label>
                            <span asp-validation-for="Email" class="text-danger"></span>
                            <span id="emailError" class="text-danger"></span>
                        </div>

                        <div class="form-floating mb-3">
                            <input asp-for="Password" class="form-control" id="Password" />
                            <label asp-for="Password"></label>
                            <span id="passwordError" class="text-danger"></span>
                        </div>

                        <div class="form-floating mb-3">
                            <input asp-for="ConfirmPassword" class="form-control" id="ConfirmPassword" />
                            <label asp-for="ConfirmPassword"></label>
                            <span id="confirmPasswordError" class="text-danger"></span>
                        </div>

                        <button class="btn btn-primary d-grid w-100">Sign Up</button>
                    </form>

                    <p class="text-center mt-3">
                        Already have an account?
                        <a asp-controller="SignIn" asp-action="Index">Login</a>
                    </p>

                </div>
            </div>
        </div>
    </div>

    <script src="~/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="~/assets/vendor/js/bootstrap.js"></script>

    <script>
        const password = document.getElementById("Password");
        const confirmPassword = document.getElementById("ConfirmPassword");
        const passwordError = document.getElementById("passwordError");
        const confirmError = document.getElementById("confirmPasswordError");

        confirmPassword.addEventListener("input", function () {
            if (password.value !== confirmPassword.value) {
                passwordError.textContent = "Passwords do not match";
                confirmError.textContent = "Passwords do not match";
            } else {
                passwordError.textContent = "";
                confirmError.textContent = "";
            }
        });

        const email = document.getElementById("Email");
        const emailError = document.getElementById("emailError");

        email.addEventListener("blur", async function () {
            const response = await fetch(`/SignUp/CheckEmail?email=${email.value}`);
            const data = await response.json();

            if (!data.available) {
                emailError.textContent = "Email already exists";
            } else {
                emailError.textContent = "";
            }
        });
    </script>

</body>
</html>
